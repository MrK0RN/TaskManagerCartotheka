# Модули параметров портрета

Портрет личности состоит из **25 параметров**, разбитых на **6 секций**. Каждый параметр реализован отдельным PHP-файлом в каталоге `modules/`: `param-1.php` … `param-25.php`.

## Как подключаются модули

- На страницах **index.php** (форма) и **view.php** (просмотр) в конфиге заданы секции и списки номеров параметров. Для каждого номера подключается файл `modules/param-{N}.php`.
- Перед включением модуля в область видимости передаются:
  - **$paramData** — массив с ключами `structured_data` (массив полей) и `free_text` (строка). Данные берутся из БД (`portrait_data` по `param_number`).
  - **$readOnly** — только на view.php: true; на index.php не задаётся (форма редактирования). В модуле используется для вывода полей только для чтения или скрытия пустых блоков при просмотре.

Модуль выводит HTML: подпись параметра, при необходимости подсказку (`help-text`), поля формы с именами вида `param_{N}_fieldname` или вложенные структуры (например, `param_8_languages[i][language_id]`), и при наличии — textarea для свободного текста `param_{N}_free_text`.

## Секции и параметры

| Секция | Параметры | Описание |
|--------|-----------|----------|
| Справочные (демографические и биографические) данные | 1–4 | ФИО, дата рождения, пол, гражданство, место рождения/проживания; остальные биографические и демографические поля |
| Ресурсы личности | 5–11 | Образование, опыт, языки, навыки и т.д. |
| Психологический профиль | 12–15 | Характер, мотивации и т.д. |
| Ценностно-смысловая сфера | 16–18 | Ценности, цели |
| Социальное измерение | 19–22 | Семья, окружение, роли |
| Поведенческие и контекстуальные паттерны | 23–25 | Привычки, контекст, итоговые заметки |

Точные названия и состав полей см. в самих файлах `modules/param-*.php`.

## Структура данных при сохранении

При сохранении формы (см. [api.md](api.md)) клиент собирает для каждого параметра объект:

- **structured_data** — плоский объект или вложенные массивы (например, языки, образование, навыки). Имена полей соответствуют полям формы без префикса `param_N_`.
- **free_text** — строка из textarea «Дополнительные детали» (если есть).

В БД это хранится в `portrait_data`: одна строка на (portrait_id, param_number), колонки `structured_data` (JSONB) и `free_text` (TEXT).

## Компоненты

Некоторые параметры используют общие компоненты из `components/`:

- **components/languages.php** — блок «Языки» (выбор языка, уровень, комментарий); добавляется/удаляется через JS (`main.js`: `addLanguage`, `removeLanguage`). Автодополнение по справочнику `languages` через `api/autocomplete.php?type=language`.
- **components/education.php** — блок «Образование» (тип, учреждение, специализация, годы); JS: `addEducation`, `removeEducation`. Учреждения — автодополнение `api/autocomplete.php?type=institution`.
- **components/skills.php** — блок «Навыки» (категория hard/soft, навык, уровень); JS: `addSkill`, `removeSkill`. Справочник и автодополнение: `api/autocomplete.php?type=skill`.

В модулях эти компоненты подключаются с нужным `$paramName` (например, `param_8` для языков).

## Добавление или изменение параметра

1. Создайте или отредактируйте файл `modules/param-N.php`.
2. Используйте переменные `$paramData`, `$readOnly`; для полей формы задавайте имена `param_N_*` или вложенные имена для массивов, чтобы их корректно собирал `scripts/form-handler.js` (см. логику сбора по `param_1` … `param_25`).
3. Секции и список параметров заданы в `index.php` и `view.php` в массиве `$sections`. Если добавляете новый параметр — добавьте его номер в нужную секцию.
4. При необходимости добавьте автодополнение в `api/autocomplete.php` и обработку в `scripts/autocomplete.js` (атрибут `data-autocomplete`, `data-autocomplete-type`).

## Просмотр (view.php)

На странице просмотра для каждого параметра вызывается `param_has_content($paramStructured, $paramFreeText)`. Если контента нет, блок этого параметра не выводится. Модули в режиме `$readOnly === true` выводят только заполненные поля (без интерактивных кнопок добавления и без пустых textarea, если это заложено в разметке).
